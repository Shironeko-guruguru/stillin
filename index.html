<!DOCTYPE html>
<html lang="ja">
<head>
  </head>
<body>
  <div id="app">
    <div class="settings-container">...</div>
    <div class="game-header">...</div>

    <div id="content">
      <div class="screen" id="main-home">
        <div class="home-content">
          <button class="home-menu-btn">ストーリー</button>
          <button class="home-menu-btn" id="goto-char-select-btn">育成</button>
        </div>
        <div class="bottom-nav">...</div>
      </div>

      <div class="screen" id="char-select">
        <h2>キャラクターを選択</h2>
        <div class="char-select-container">
          <div class="char-card selected" data-char="char1">
            <p>元気な研修生</p>
          </div>
          <div class="char-card" data-char="char2">
            <p>クールな先輩</p>
          </div>
          <div class="char-card" data-char="char3">
            <p>謎の転校生</p>
          </div>
        </div>
        <button class="btn main" id="confirm-char-btn">このキャラで育成開始</button>
      </div>
      <div class="screen" id="ikusei-home">
        <div id="parameter-bars">
          <div class="param-bar-container">
            <span class="param-label">STR</span>
            <div class="param-bar"><div id="str-bar" class="param-bar-fill"></div></div>
            <span id="str-value" class="param-value">0</span>
          </div>
          <div class="param-bar-container">
            <span class="param-label">AGI</span>
            <div class="param-bar"><div id="agi-bar" class="param-bar-fill"></div></div>
            <span id="agi-value" class="param-value">0</span>
          </div>
          <div class="param-bar-container">
            <span class="param-label">VIT</span>
            <div class="param-bar"><div id="vit-bar" class="param-bar-fill"></div></div>
            <span id="vit-value" class="param-value">0</span>
          </div>
          <div class="param-bar-container">
            <span class="param-label">DEX</span>
            <div class="param-bar"><div id="dex-bar" class="param-bar-fill"></div></div>
            <span id="dex-value" class="param-value">0</span>
          </div>
        </div>
        <div id="buff-display"></div> <div class="game-footer">
          <div class="row top-row">
            <button class="btn side" id="rest-btn">お休み</button>
            <button class="btn main" onclick="showScreen('training')">トレーニング</button>
            <button class="btn side">スキル</button>
          </div>
          <div class="row bottom-row">
            <button class="btn sub">アイテム</button>
            <button class="btn sub" id="outing-btn">お出掛け</button>
          </div>
        </div>
      </div>

      <div class="screen" id="training">
        <div class="game-footer">
          <div class="row top-row">
            <button class="btn small" data-stat="str">STR</button>
            <button class="btn small" data-stat="agi">AGI</button>
            <button class="btn small" data-stat="vit">VIT</button>
            <button class="btn small" data-stat="dex">DEX</button>
          </div>
          <div class="row bottom-row">
            <button class="btn main" onclick="showScreen('ikusei-home')">もどる</button>
          </div>
        </div>
      </div>

    </div>
  </div>
  <script>
    // ===== ゲームの状態を管理するオブジェクト =====
let gameState = {};

// ===== UI更新用の要素をあらかじめ取得 =====
const hpValue = document.getElementById('hp-value');
const turnValue = document.getElementById('turn-value');
const strBar = document.getElementById('str-bar');
const agiBar = document.getElementById('agi-bar');
const vitBar = document.getElementById('vit-bar');
const dexBar = document.getElementById('dex-bar');
const strValue = document.getElementById('str-value');
const agiValue = document.getElementById('agi-value');
const vitValue = document.getElementById('vit-value');
const dexValue = document.getElementById('dex-value');
const buffDisplay = document.getElementById('buff-display');

// ===== ゲーム初期化関数 =====
function initializeGame() {
  gameState = {
    hp: 100,
    maxHp: 100,
    turn: 24,
    maxTurn: 24,
    str: 10,
    agi: 10,
    vit: 10,
    dex: 10,
    maxStat: 200, // パラメータの最大値
    trainingBuffTurns: 0, // パラメータ上昇量アップ効果の残りターン
  };
  updateUI();
  showScreen('ikusei-home');
}

// ===== UIを最新の状態に更新する関数 =====
function updateUI() {
  // 体力・ターンの表示更新
  hpValue.textContent = `${gameState.hp} / ${gameState.maxHp}`;
  turnValue.textContent = `${gameState.turn} / ${gameState.maxTurn}`;
  
  // パラメータバーの表示更新
  strBar.style.width = `${(gameState.str / gameState.maxStat) * 100}%`;
  agiBar.style.width = `${(gameState.agi / gameState.maxStat) * 100}%`;
  vitBar.style.width = `${(gameState.vit / gameState.maxStat) * 100}%`;
  dexBar.style.width = `${(gameState.dex / gameState.maxStat) * 100}%`;
  strValue.textContent = gameState.str;
  agiValue.textContent = gameState.agi;
  vitValue.textContent = gameState.vit;
  dexValue.textContent = gameState.dex;

  // 特殊効果（バフ）の表示更新
  if (gameState.trainingBuffTurns > 0) {
    buffDisplay.textContent = `パラメータ上昇量アップ中 (あと${gameState.trainingBuffTurns}ターン)`;
  } else {
    buffDisplay.textContent = '';
  }
}

// ===== 基本的な画面制御 (変更なし) =====
const gameHeader = document.querySelector('.game-header');
let currentScreenId = '';
function showScreen(id) {
    // ... (この関数の中身は変更なし) ...
}

// ===== 各ボタンのイベントリスナー =====

// 1. ホーム画面 → キャラ選択画面へ
document.getElementById('goto-char-select-btn').addEventListener('click', () => {
  showScreen('char-select');
});

// 2. キャラクター選択
document.querySelectorAll('.char-card').forEach(card => {
  card.addEventListener('click', () => {
    document.querySelector('.char-card.selected').classList.remove('selected');
    card.classList.add('selected');
  });
});

// 3. キャラクター決定 → 育成開始
document.getElementById('confirm-char-btn').addEventListener('click', () => {
  initializeGame();
});

// 4. トレーニングボタン
document.querySelectorAll('.btn.small').forEach(button => {
  button.addEventListener('click', () => {
    if (gameState.turn <= 0) return; // ターンがなければ何もしない

    const statType = button.dataset.stat;
    const hpPercent = gameState.hp / gameState.maxHp;
    let baseGain = 10;
    
    // 体力によるパラメータ上昇量の変動
    if (hpPercent < 0.4) baseGain *= 0.6; // 体力が40%未満なら効率ダウン
    if (hpPercent > 0.8) baseGain *= 1.4; // 体力が80%以上なら効率アップ
    
    // お出掛けによる特殊効果
    if (gameState.trainingBuffTurns > 0) {
      baseGain *= 1.5; // 上昇量1.5倍
    }
    
    // ターンと特殊効果の消費
    gameState.turn--;
    if (gameState.trainingBuffTurns > 0) gameState.trainingBuffTurns--;

    // パラメータと体力を更新
    gameState[statType] = Math.min(gameState.maxStat, gameState[statType] + Math.round(baseGain));
    gameState.hp = Math.max(0, gameState.hp - 15);

    updateUI();
    showScreen('ikusei-home');
  });
});

// 5. お休みボタン
document.getElementById('rest-btn').addEventListener('click', () => {
  if (gameState.turn <= 0) return;
  gameState.turn--;
  if (gameState.trainingBuffTurns > 0) gameState.trainingBuffTurns--;

  const recovery = 70; // 回復量
  gameState.hp = Math.min(gameState.maxHp, gameState.hp + recovery);
  updateUI();
});

// 6. お出掛けボタン
document.getElementById('outing-btn').addEventListener('click', () => {
  if (gameState.turn <= 0) return;
  gameState.turn--;
  
  const recovery = 30; // お休みより回復量は少ない
  gameState.hp = Math.min(gameState.maxHp, gameState.hp + recovery);
  gameState.trainingBuffTurns = 5; // 5ターンの間、特殊効果を付与
  updateUI();
});


// ===== ハンバーガーメニュー制御 (変更なし) =====
const settingsBtn = document.querySelector('.settings-btn');
// ... (以降のハンバーガーメニュー関連のコードは変更なし) ...

// ===== 初期画面の設定 =====
showScreen("main-home");
  </script>
</body>
</html>